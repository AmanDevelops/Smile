<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixel Smile Snap! ðŸ˜„ðŸ“¸</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Ensure font inheritance */
      * {
        font-family: inherit;
      }

      body {
        font-family: "Press Start 2P", cursive;
        text-align: center;
        background: #fff5e6;
        margin: 0;
        padding: 20px;
        padding-top: 0;
        padding-bottom: 0;
        color: #bde0fe;
        min-height: 100vh;
        justify-content: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        image-rendering: pixelated;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(0.95);
        }
      }

      @keyframes imagePop {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        100% {
          opacity: 1;
          transform: scale(1);
        }
      }

      h1,
      h2,
      .code-highlight,
      #feedback,
      .loading,
      .error {
        font-family: inherit; /* Ensure inheritance */
      }

      h1 {
        font-size: 1.5rem;
        color: #bde0fe;
        text-shadow: 2px 2px #5555ff;
        margin-bottom: 40px;
        animation: fadeIn 1s ease-in-out;
      }

      .menu,
      .click-pics,
      .show-pics {
        background: #333333;
        padding: 20px;
        border: 4px solid #a2d2ff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.5s ease-in-out;
      }

      button {
        font-family: inherit; /* Inherit from body */
        background: #ffcce6;
        color: #333333;
        border: 4px solid #99ccff;
        padding: 10px;
        font-size: 0.9rem;
        cursor: pointer;
        border-radius: 4px;
        transition: transform 0.1s, background 0.2s, border-color 0.2s;
        text-transform: uppercase;
        image-rendering: pixelated;
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .menu-buttons button {
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 0.8rem;
        padding: 0;
        line-height: 1.2;
        margin-left: auto;
        margin-right: auto;
      }

      .menu-buttons {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 15px;
      }

      button:hover {
        background: #ffafcc;
        border-color: #a2d2ff;
        transform: scale(1.05);
      }

      button:active {
        animation: pop 0.2s;
        transform: scale(0.95);
      }

      div.menu .menu-buttons button {
        /* Removed font-family to inherit from body */
      }

      .video-container {
        border: 6px solid #99ccff;
        border-radius: 4px;
        overflow: hidden;
        background: #111111;
        position: relative;
        max-width: 100%;
      }

      .video-container::before {
        content: "ðŸ“¸";
        position: absolute;
        top: 10px;
        left: 10px;
        font-size: 2rem;
        color: #99ccff;
      }

      .video-container img {
        width: 100%;
        max-width: 640px;
        height: auto;
        display: block;
        image-rendering: pixelated;
      }

      .button-container {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        gap: 10px;
      }

      .captured-images {
        margin-top: 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
      }

      .captured-images img {
        width: 80px;
        height: 80px;
        border: 3px solid #a2d2ff;
        border-radius: 4px;
        image-rendering: pixelated;
        transition: transform 0.2s;
        animation: imagePop 0.3s ease-in;
      }

      .captured-images img:hover {
        transform: scale(1.2);
      }

      .loading,
      .error {
        font-size: 0.8rem;
        color: #ff5555;
        margin-top: 15px;
        display: none;
      }

      .feedback-success {
        color: #55ff55;
      }

      h2 {
        font-size: 1rem;
        color: #cdb4db;
        margin-top: 40px;
        text-shadow: 1px 1px #9f86c0;
      }

      .code-highlight {
        color: #71d0d0;
        background: #333333;
        padding: 2px 6px;
        border-radius: 4px;
      }

      @media (max-width: 600px) {
        h1 {
          font-size: 1.2rem;
        }

        .menu-buttons button {
          width: 80px;
          height: 80px;
          font-size: 0.6rem;
        }

        button {
          padding: 8px;
          font-size: 0.8rem;
        }

        .captured-images img {
          width: 60px;
          height: 60px;
        }

        .video-container img {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div id="menu" class="menu">
      <h1>ðŸ˜„ Pixel Smile Snap! ðŸ“¸</h1>
      <div class="menu-buttons">
        <div>
          <button onclick="showClickPics()" aria-label="Start capturing photos">
            Click Pics!
          </button>
        </div>
        <div>
          <button onclick="showPics()" aria-label="View captured photos">
            Show Snaps!
          </button>
        </div>
      </div>
      <h2>Your Code: <span class="code-highlight">{{ folder_code }}</span></h2>
    </div>

    <div id="clickPics" class="click-pics" style="display: none">
      <h1>ðŸ“¸ Say CHEEESE ðŸ§€</h1>
      <div class="video-container">
        <img
          src="{{ url_for('video_feed') }}"
          alt="Video Feed"
          class="video-feed"
        />
      </div>
      <div id="feedback" style="font-size: 0.8rem; margin-top: 10px"></div>
      <div class="button-container">
        <button onclick="showPics()" aria-label="View captured photos">
          Show Snaps!
        </button>
        <button onclick="showMenu()" aria-label="Reset and start over">
          Done!
        </button>
      </div>
      <h2>Your Code: <span class="code-highlight">{{ folder_code }}</span></h2>
    </div>

    <div id="showPics" class="show-pics" style="display: none">
      <h1>ðŸŽ® Your Snaps!</h1>
      <div class="loading" id="loading">Loading snaps... âœ¨</div>
      <div class="error" id="error"></div>
      <div class="captured-images" id="capturedImages"></div>
      <div class="button-container">
        <button onclick="smoothReload()" aria-label="Reload the page">
          Click More!
        </button>
        <button onclick="showMenu()" aria-label="Return to main menu">
          Done!
        </button>
      </div>
      <h2>Your Code: <span class="code-highlight">{{ folder_code }}</span></h2>
    </div>

    <script>
      function showMenu() {
        document.getElementById("menu").style.display = "block";
        document.getElementById("clickPics").style.display = "none";
        document.getElementById("showPics").style.display = "none";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function showClickPics() {
        document.getElementById("menu").style.display = "none";
        document.getElementById("clickPics").style.display = "block";
        document.getElementById("showPics").style.display = "none";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }
      function smoothReload() {
        const feedback = document.getElementById("feedback");
        feedback.textContent = "Resetting...";
        setTimeout(() => {
          location.reload();
        }, 500); // Wait for transition
      }
      function showPics() {
        document.getElementById("menu").style.display = "none";
        document.getElementById("clickPics").style.display = "none";
        document.getElementById("showPics").style.display = "block";
        loadCapturedImages();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      async function loadCapturedImages() {
        const loading = document.getElementById("loading");
        const error = document.getElementById("error");
        const imageContainer = document.getElementById("capturedImages");

        loading.style.display = "block";
        error.style.display = "none";
        imageContainer.innerHTML = "";

        try {
          const response = await fetch("/get_images");
          if (!response.ok) throw new Error("Failed to fetch images");
          const data = await response.json();
          if (data.error) throw new Error(data.error);

          data.images.forEach((image, index) => {
            const imgElement = document.createElement("img");
            imgElement.src = `/static/images/${image}`;
            imgElement.style.animationDelay = `${index * 0.1}s`;
            imageContainer.appendChild(imgElement);
          });

          setTimeout(() => {
            window.scrollTo({
              top: document.body.scrollHeight,
              behavior: "smooth",
            });
          }, 300);
        } catch (err) {
          error.textContent = `Oops! ${err.message}`;
          error.style.display = "block";
        } finally {
          loading.style.display = "none";
        }
      }

      async function updateFeedback() {
        const feedback = document.getElementById("feedback");
        try {
          const response = await fetch("/detection_status");
          if (!response.ok) throw new Error("Failed to fetch detection status");
          const data = await response.json();
          feedback.textContent = data.message || "";
          feedback.className = data.message.includes("Smile detected!")
            ? "feedback-success"
            : "";
        } catch (err) {
          feedback.textContent = "Error fetching feedback. Please try again.";
          feedback.className = "";
          console.error("Failed to fetch detection status:", err);
        }
      }

      setInterval(() => {
        if (document.getElementById("clickPics").style.display === "block") {
          updateFeedback();
        }
      }, 2000);
    </script>
  </body>
</html>
